<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Track Shipment</title>
<style>
  body {
    font-family: Arial, sans-serif; background:#f5f5f5;
    min-height:100vh; display:flex; align-items:center; justify-content:center;
    padding:20px;
  }
  .track-box {
    background:#fff; width:320px; border-radius:8px; padding:18px;
    box-shadow:0 2px 8px rgba(0,0,0,0.1); text-align:center;
  }
  .icon { width:40px; margin-bottom:10px; }
  h3 { font-size:18px; margin:0 0 16px; }
  .radio-group { display:flex; justify-content:center; gap:20px; margin-bottom:16px; }
  label { display:flex; align-items:center; font-weight:bold; font-size:15px; }
  input[type="radio"] { margin-right:6px; transform:scale(1.2); }
  #searchInput {
    width:80%; padding:10px; border:1px solid #ccc; border-radius:6px;
    font-size:14px; margin:0 auto 12px; display:block;
  }
  .error { color:#c0392b; font-size:13px; min-height:16px; margin-bottom:8px; }
  button {
    width:100%; background:#28a745; color:#fff; padding:10px; border:0;
    border-radius:6px; font-size:16px; cursor:pointer;
  }
  button:hover { background:#218838; }
  .result { margin-top:14px; text-align:left; font-size:14px; }
  .badge { display:inline-block; padding:6px 10px; border-radius:20px; background:#eef3ff; }
  .notfound { color:#c0392b; }
  .loading { font-style:italic; opacity:0.8; }
  small.muted { color:#777; display:block; margin-top:6px; }
</style>
</head>
<body>

<div class="track-box">
  <img class="icon" src="https://cdn-icons-png.flaticon.com/512/3081/3081835.png" alt="Shopping Icon">
  <h3>Track status of your shipment</h3>

  <div class="radio-group">
    <label><input type="radio" name="searchBy" value="order" checked>Order ID</label>
    <label><input type="radio" name="searchBy" value="mobile">Mobile</label>
  </div>

  <input type="text" id="searchInput" placeholder="Enter Order ID to search">
  <div class="error" id="err"></div>
  <button id="btn">Submit</button>

  <div class="result" id="result"></div>
</div>

<script>
const SHEET_ID   = "17p4MOYpWLEjtsumyz0keYMkdzWD8SiYa_kRNrKPxx5A"; // aapka sheet ID
const SHEET_NAME = "Sheet1"; // yahan apne tab ka exact naam likhein (e.g. "Orders")

const radios = document.querySelectorAll('input[name="searchBy"]');
const searchInput = document.getElementById('searchInput');
const err = document.getElementById('err');
const result = document.getElementById('result');
const btn = document.getElementById('btn');

radios.forEach(r => {
  r.addEventListener('change', () => {
    if (r.checked && r.value === 'order') {
      searchInput.type = 'text';
      searchInput.placeholder = 'Enter Order ID to search';
    } else if (r.checked && r.value === 'mobile') {
      searchInput.type = 'tel';
      searchInput.placeholder = 'Enter Mobile Number to search';
    }
    err.textContent = '';
    result.innerHTML = '';
  });
});

btn.addEventListener('click', trackShipment);

async function trackShipment() {
  err.textContent = '';
  result.innerHTML = '';

  const mode = [...radios].find(r => r.checked).value;
  const qRaw = searchInput.value.trim();
  if (!qRaw) { err.textContent = 'Please enter a value.'; return; }

  // Basic validation
  if (mode === 'mobile') {
    const digits = qRaw.replace(/\D/g,'');
    if (digits.length < 10) { err.textContent = 'Enter a valid 10-digit Mobile Number.'; return; }
  } else {
    if (qRaw.length < 3) { err.textContent = 'Enter a valid Order ID.'; return; }
  }

  result.innerHTML = '<div class="loading">Fetching statusâ€¦</div>';

  try {
    const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET_NAME)}`;
    const res = await fetch(url);
    const text = await res.text();

    // gviz response ko clean JSON me convert
    const json = JSON.parse(text.substring(text.indexOf('{'), text.lastIndexOf('}') + 1));

    // Expect columns: [Order ID, Mobile Number, Status]
    const rows = (json.table.rows || []).map(r => ({
      orderId: (r.c[0]?.v ?? '').toString().trim(),
      mobile:  (r.c[1]?.v ?? '').toString().trim(),
      status:  (r.c[2]?.v ?? '').toString().trim()
    }));

    const q = qRaw.toLowerCase();
    const found = rows.find(row => {
      const byOrder  = row.orderId.toLowerCase() === q;
      const byMobile = row.mobile.replace(/\D/g,'') === q.replace(/\D/g,'');
      return byOrder || byMobile;
    });

    if (found) {
    let customMessage = '';
    if (found.status.toLowerCase() === 'delivered') {
        customMessage = 'âœ… Aapka order aap tak pahunch gaya hai. Shukriya!';
    } else {
        customMessage = 'ðŸšš Aapka order safar par hai, har station ka update yahin milega.';
    }
    
    result.innerHTML = `
    <div><strong>Order ID:</strong> ${found.orderId || '-'}</div>
    <div><strong>Mobile:</strong> ${found.mobile || '-'}</div>
    <div style="margin-top:8px"><span class="badge">Status: ${found.status || 'â€”'}</span></div>
    <small class="muted">${customMessage}</small>
  `;
} else {
      result.innerHTML = `<div class="notfound">Record not found. Please check Order ID / Mobile.</div>`;
    }
  } catch (e) {
    console.error(e);
    result.innerHTML = `<div class="notfound">Could not fetch data. Check sheet sharing (Anyone with link: Viewer) and sheet/tab name.</div>`;
  }
}
</script>
</body>
</html>